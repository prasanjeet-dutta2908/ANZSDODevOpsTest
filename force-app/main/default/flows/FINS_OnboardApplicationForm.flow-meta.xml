<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <description>Determines the status of the Flow Orchestration Instance Related Object record and decides whether the orchestration run can be restarted or terminated.</description>
        <name>CheckFlowOrchestrationInstanceRelatedObjectStatus</name>
        <label>What’s the Flow Orchestration Instance Related Object Status?</label>
        <locationX>578</locationX>
        <locationY>1895</locationY>
        <defaultConnectorLabel>Other (Default)</defaultConnectorLabel>
        <rules>
            <name>IsRestart</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>EvaluateWhetherFlowConditionsAreMet.Outputs.flowOrchestrationInstRelatedObjStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Restarted</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CheckTheTheApplicationFormStage</targetReference>
            </connector>
            <label>Restart</label>
        </rules>
        <rules>
            <name>IsTerminate</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>EvaluateWhetherFlowConditionsAreMet.Outputs.flowOrchestrationInstRelatedObjStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>FinishedWithErrors</stringValue>
                </rightValue>
            </conditions>
            <label>Terminate</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines the stage of the Application Form record and either restarts the orchestration instance or processes the application form onboarding.</description>
        <name>CheckStageOfTheApplicationForm</name>
        <label>What’s the Stage of the Application Form?</label>
        <locationX>1034</locationX>
        <locationY>503</locationY>
        <defaultConnectorLabel>Other (Default)</defaultConnectorLabel>
        <rules>
            <name>IsInProgress</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Stage</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>In Progress</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Stage</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Initiated</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>PerformApplicationFormOnboardingActions</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>In Progress</label>
        </rules>
        <rules>
            <name>IsCompleted</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Stage</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Approved</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>PerformApplicantFormPostOnboardingActions</targetReference>
            </connector>
            <label>Completed</label>
        </rules>
        <rules>
            <name>IsRejected</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Stage</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rejected</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>PerformApplicantFormPostOnboardingActions</targetReference>
            </connector>
            <label>Rejected</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines the stage of the Application Form to identify the flow orchestration stage from which the flow is restarted.</description>
        <name>CheckTheTheApplicationFormStage</name>
        <label>What is the Application Form Stage?</label>
        <locationX>50</locationX>
        <locationY>2003</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>InitiatePreOnboardingRestart</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>PerformApplicationFormPreOnboardingActions</targetReference>
            </connector>
            <label>Initiate Pre-Onboarding Process Step Restart</label>
        </rules>
        <rules>
            <name>InitiateOnboardingProcessRestart</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InitiateOnboardingProcess.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>PerformApplicationFormOnboardingActions</targetReference>
            </connector>
            <label>Initiate Onboarding Process Step Restart</label>
        </rules>
        <rules>
            <name>CheckOnboardCompletionStatusRestart</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CheckOnboardCompletionStatus.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>PerformApplicantFormPostOnboardingActions</targetReference>
            </connector>
            <label>Check the Onboard Completion Step Status Restart</label>
        </rules>
        <rules>
            <name>CreateAccountRestart</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CreateAccount.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>UpdateExternalBankingSystem</targetReference>
            </connector>
            <label>Create an Account Step Restart</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines whether the account was created in the external banking system or not.</description>
        <name>IsExternalBankingSystemUpdated</name>
        <label>Is the External Banking System Updated?</label>
        <locationX>737</locationX>
        <locationY>1151</locationY>
        <defaultConnectorLabel>Yes (Default)</defaultConnectorLabel>
        <rules>
            <name>ExternalBankingSystemNotUpdated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CreateAccount.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>HandleExceptions</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines whether the onboarding process for the application form was completed or not.</description>
        <name>IsOnboardingProcessCompleted</name>
        <label>Is the Onboarding Process Completed?</label>
        <locationX>451</locationX>
        <locationY>719</locationY>
        <defaultConnector>
            <targetReference>PerformApplicantFormPostOnboardingActions</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes (Default)</defaultConnectorLabel>
        <rules>
            <name>OnboardingProcessNotCompleted</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>InitiateOnboardingProcess.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>HandleExceptions</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines whether the pre-onboarding process for the application form is completed or not.</description>
        <name>IsTheApplicationFormReadyForOnboarding</name>
        <label>Is the Application Form Ready for Onboarding?</label>
        <locationX>578</locationX>
        <locationY>395</locationY>
        <defaultConnector>
            <targetReference>CheckStageOfTheApplicationForm</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes (Default)</defaultConnectorLabel>
        <rules>
            <name>PreOnboardingNotCompleted</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InitiatePreOnboarding.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>HandleExceptions</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines whether the status of the Application Form is completed, and the Accounts and Opportunity records were updated.</description>
        <name>WereAccountAndOpportunityRecordsUpdated</name>
        <label>Were the Account and Opportunity Records Updated?</label>
        <locationX>605</locationX>
        <locationY>935</locationY>
        <defaultConnector>
            <targetReference>UpdateExternalBankingSystem</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes (Default)</defaultConnectorLabel>
        <rules>
            <name>AccountAndOpportunityRecordsNotUpdated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CheckOnboardCompletionStatus.Outputs.isFlowFailed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>HandleExceptions</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <description>When the Flow Orchestration Instance Reference Object record is created with Application Form as the reference object, this flow orchestration creates an Applicant record, a Party Profile record, and an Assessment record. The flow orchestration then processes the Application Form to onboard a new applicant.</description>
    <environments>Default</environments>
    <formulas>
        <description>Creates an error message by concatenating the error messages from the flow orchestration stages.</description>
        <name>ErrorMessage</name>
        <dataType>String</dataType>
        <expression>{!InitiatePreOnboarding.Outputs.errorMessage}+{!InitiateOnboardingProcess.Outputs.ErrorMessage}+{!CheckOnboardCompletionStatus.Outputs.errorMessage}+{!CreateAccount.Outputs.errorMessage}</expression>
    </formulas>
    <interviewLabel>Onboarding: Process an Application Form to Onboard a New Applicant {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Onboarding: Process an Application Form to Onboard a New Applicant</label>
    <orchestratedStages>
        <description>Handles exceptions and determines whether the flow conditions were met.</description>
        <name>HandleExceptions</name>
        <label>Handle Exceptions</label>
        <locationX>578</locationX>
        <locationY>1787</locationY>
        <connector>
            <targetReference>CheckFlowOrchestrationInstanceRelatedObjectStatus</targetReference>
        </connector>
        <exitConditionLogic>and</exitConditionLogic>
        <stageSteps>
            <description>If the status of the flow orchestration instance is set to Failed, the flow creates a Process Exception record to process the errors. The flow then updates the stage of the Flow Orchestration Inst Related Obj record to Fix Exceptions. Otherwise, displays an error to the flow user.</description>
            <name>HandleErrorsWithProcessException</name>
            <actionName>fsc_onboarding__ProcessRunErrors</actionName>
            <actionType>stepBackground</actionType>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>AttachedToID</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>FlowOrchestrationInstRelatedObjID</name>
                <value>
                    <elementReference>$Record.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>Description</name>
                <value>
                    <elementReference>ErrorMessage</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>Message</name>
                <value>
                    <stringValue>We couldn&apos;t complete the Orchestration run.Try again or contact Salesforce Customer Support for help.</stringValue>
                </value>
            </inputParameters>
            <label>Handle Errors with Process Exception</label>
            <requiresAsyncProcessing>false</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>BackgroundStep</stepSubtype>
        </stageSteps>
        <stageSteps>
            <description>Checks the status of the Flow Orchestration Instance Related Object record. If the status is Finished with Errors or is Terminated, the flow sets the value of the isOrchestrationConditionMet variable to True. Else, the flow sets the value of the isOrchestrationConditionMet variable to False.</description>
            <name>EvaluateWhetherFlowConditionsAreMet</name>
            <actionName>fsc_onboarding__ResumeIfIsFixExcp</actionName>
            <actionType>stepBackground</actionType>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryActionInputParameters>
                <name>flowOrchestrationInstRelatedObjID</name>
                <value>
                    <elementReference>$Record.Id</elementReference>
                </value>
            </entryActionInputParameters>
            <entryActionName>fsc_onboarding__EvalResumeCondition</entryActionName>
            <entryActionType>evaluationFlow</entryActionType>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>flowOrchestrationInstRelatedObjId</name>
                <value>
                    <elementReference>$Record.Id</elementReference>
                </value>
            </inputParameters>
            <label>Evaluate Whether Flow Conditions Are Met</label>
            <requiresAsyncProcessing>false</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>BackgroundStep</stepSubtype>
        </stageSteps>
    </orchestratedStages>
    <orchestratedStages>
        <description>Performs the post-onboarding actions for the applicant.</description>
        <name>PerformApplicantFormPostOnboardingActions</name>
        <label>Perform Applicant Form Post-Onboarding Actions</label>
        <locationX>605</locationX>
        <locationY>827</locationY>
        <connector>
            <targetReference>WereAccountAndOpportunityRecordsUpdated</targetReference>
        </connector>
        <exitConditionLogic>and</exitConditionLogic>
        <stageSteps>
            <description>Checks if the Application Form stage is set to Completed. If the stage is Completed, the flow updates the Account record with the applicant details and sets the stage of the Opportunity record to Closed Won. Otherwise, the flow waits until the Application Form status is set to Completed.</description>
            <name>CheckOnboardCompletionStatus</name>
            <actionName>fsc_onboarding__UpdateAccAndOppt</actionName>
            <actionType>stepBackground</actionType>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryActionInputParameters>
                <name>ApplicationFormID</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </entryActionInputParameters>
            <entryActionName>fsc_onboarding__EvalAppFormStage</entryActionName>
            <entryActionType>evaluationFlow</entryActionType>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>applicationFormId</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>convertedLeadAccountID</name>
                <value>
                    <elementReference>InitiatePreOnboarding.Outputs.applicationFormRecord.AccountId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>convertedOpportunityId</name>
                <value>
                    <elementReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Opportunity.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>FlowOrchInstRelaObjectId</name>
                <value>
                    <elementReference>$Record.Id</elementReference>
                </value>
            </inputParameters>
            <label>Check the Onboard Completion Status</label>
            <requiresAsyncProcessing>false</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>BackgroundStep</stepSubtype>
        </stageSteps>
    </orchestratedStages>
    <orchestratedStages>
        <description>Performs the actions to onboard an applicant.</description>
        <name>PerformApplicationFormOnboardingActions</name>
        <label>Perform Application Form Onboarding Actions</label>
        <locationX>451</locationX>
        <locationY>611</locationY>
        <connector>
            <targetReference>IsOnboardingProcessCompleted</targetReference>
        </connector>
        <exitConditionLogic>and</exitConditionLogic>
        <stageSteps>
            <description>Captures the applicant’s information from the Lead record and creates an Applicant record for the lead. Allows the user to provide the product information, and then creates Party Profile, Application Form Product, and Assessment records to initiate the onboarding process.</description>
            <name>InitiateOnboardingProcess</name>
            <actionName>fsc_onboarding__ApplFormOnboarding</actionName>
            <actionType>stepInteractive</actionType>
            <assignees>
                <assignee>
                    <stringValue>FINS_Back_Office</stringValue>
                </assignee>
                <assigneeType>Queue</assigneeType>
            </assignees>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>applicationFormId</name>
                <value>
                    <elementReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>ActionInput__RecordId</name>
                <value>
                    <elementReference>InitiatePreOnboarding.Outputs.applicationFormRecord.Id</elementReference>
                </value>
            </inputParameters>
            <label>Initiate Onboarding Process</label>
            <requiresAsyncProcessing>false</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>InteractiveStep</stepSubtype>
        </stageSteps>
    </orchestratedStages>
    <orchestratedStages>
        <description>Performs the pre-onboarding actions before onboarding an applicant.</description>
        <name>PerformApplicationFormPreOnboardingActions</name>
        <label>Perform Application Form Pre-Onboarding Actions</label>
        <locationX>578</locationX>
        <locationY>287</locationY>
        <connector>
            <targetReference>IsTheApplicationFormReadyForOnboarding</targetReference>
        </connector>
        <exitConditionLogic>and</exitConditionLogic>
        <stageSteps>
            <description>Updates the Flow Orchestration Inst Related Obj record with the Flow Orchestration Instance ID.
                The flow then gets the Application Form record that matches the ApplicationFormID passed into the flow and stores it in a record variable.</description>
            <name>InitiatePreOnboarding</name>
            <actionName>fsc_onboarding__OnboardingResumeAppln</actionName>
            <actionType>stepBackground</actionType>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>applicationFormId</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>FlowOrchestrationInstRelatedObjId</name>
                <value>
                    <elementReference>$Record.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>FlowOrchestrationInstanceId</name>
                <value>
                    <elementReference>$Orchestration.Instance</elementReference>
                </value>
            </inputParameters>
            <label>Initiate Pre-Onboarding Process</label>
            <requiresAsyncProcessing>false</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>BackgroundStep</stepSubtype>
        </stageSteps>
    </orchestratedStages>
    <orchestratedStages>
        <description>Creates an account for the applicant in the external banking system.</description>
        <name>UpdateExternalBankingSystem</name>
        <label>Update External Banking System</label>
        <locationX>737</locationX>
        <locationY>1043</locationY>
        <connector>
            <targetReference>IsExternalBankingSystemUpdated</targetReference>
        </connector>
        <exitConditionLogic>and</exitConditionLogic>
        <stageSteps>
            <description>Calls an integration definition to create an account for the applicant in the external banking system. Otherwise, the status of the flow orchestration instance is set to Failed.</description>
            <name>CreateAccount</name>
            <actionName>fsc_onboarding__InvokeExtlAsyncAction</actionName>
            <actionType>stepBackground</actionType>
            <canAssigneeEdit>false</canAssigneeEdit>
            <debugSimulateStep>false</debugSimulateStep>
            <entryConditionLogic>and</entryConditionLogic>
            <exitConditionLogic>and</exitConditionLogic>
            <inputParameters>
                <name>inputRecordID</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>integrationDefinitionName</name>
                <value>
                    <stringValue>OpenAccounts</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>outputRecordID</name>
                <value>
                    <elementReference>$Record.RelatedObjectId</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>isSkipFlowExecution</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <label>Create an Account</label>
            <requiresAsyncProcessing>true</requiresAsyncProcessing>
            <runAsUser>true</runAsUser>
            <shouldLock>false</shouldLock>
            <stepSubtype>BackgroundStep</stepSubtype>
        </stageSteps>
    </orchestratedStages>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processType>Orchestrator</processType>
    <sourceTemplate>fsc_onboarding__OnboardApplicationForm</sourceTemplate>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>PerformApplicationFormPreOnboardingActions</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RelatedObjectId</field>
            <operator>StartsWith</operator>
            <value>
                <stringValue>13X</stringValue>
            </value>
        </filters>
        <object>FlowOrchestrationInstRelaObj</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
